Ti·∫øp t·ª•c ho√†n thi·ªán ph·∫ßn m·ªÅm, h√£y tham kh·∫£o ph√¢n t√≠ch k·ªπ thu·∫≠t c·ªßa t√¥i ƒë·ªÉ l·ª±a ch·ªçn ph∆∞∆°ng √°n t·ªëi ∆∞u tr√™n c∆° s·ªü code ngu·ªìn: "R·∫•t t·ªët üëè ‚Äî b·∫°n ƒëang y√™u c·∫ßu m√¨nh **h∆∞·ªõng d·∫´n chuy√™n s√¢u ƒë·ªÉ ho√†n thi·ªán 12 module c√≤n thi·∫øu** (ƒë√£ ƒë∆∞·ª£c li·ªát k√™ r√µ trong b√°o c√°o ‚ÄúBACKEND_FRONTEND_SYNC_ANALYSIS.pdf‚Äù).
Ta s·∫Ω ƒëi **theo ƒë√∫ng th·ª© t·ª± ∆∞u ti√™n (Urgent ‚Üí High ‚Üí Medium ‚Üí Low)**, v√† v·ªõi **m·ªói module**, t√¥i s·∫Ω tr√¨nh b√†y ƒë·∫ßy ƒë·ªß:

> **C·∫•u tr√∫c h∆∞·ªõng d·∫´n chi ti·∫øt:**
> 1Ô∏è‚É£ M·ª•c ƒë√≠ch nghi·ªáp v·ª•
> 2Ô∏è‚É£ Lu·ªìng d·ªØ li·ªáu
> 3Ô∏è‚É£ Tri·ªÉn khai Backend (API code m·∫´u ‚Äì Next.js App Router)
> 4Ô∏è‚É£ Tri·ªÉn khai Frontend (React logic)
> 5Ô∏è‚É£ G·ª£i √Ω UI (layout v√† component ƒë·ªÅ xu·∫•t)
> 6Ô∏è‚É£ L∆∞u √Ω b·∫£o m·∫≠t v√† ki·ªÉm th·ª≠

---

# ‚ö†Ô∏è GIAI ƒêO·∫†N 1 ‚Äî URGENT MODULES

## **1. Role Escalation Management (Qu·∫£n l√Ω n√¢ng c·∫•p quy·ªÅn)**

### 1Ô∏è‚É£ M·ª•c ƒë√≠ch

Cho ph√©p ng∆∞·ªùi d√πng (t√°c gi·∫£, ph·∫£n bi·ªán, v.v.) g·ª≠i y√™u c·∫ßu n√¢ng quy·ªÅn l√™n ‚ÄúEditor‚Äù, ‚ÄúReviewer‚Äù ho·∫∑c ‚ÄúAdmin‚Äù.
Ban qu·∫£n tr·ªã (EIC, Sysadmin) duy·ªát ho·∫∑c t·ª´ ch·ªëi.

---

### 2Ô∏è‚É£ Lu·ªìng d·ªØ li·ªáu

```
User -> POST /api/admin/role-escalation
Admin -> GET /api/admin/role-escalation
Admin -> PATCH /api/admin/role-escalation/[id]
```

---

### 3Ô∏è‚É£ Backend (app/api/admin/role-escalation/route.ts)

```ts
import prisma from "@/lib/db";
import { NextResponse } from "next/server";

export async function GET() {
  const requests = await prisma.roleEscalation.findMany({
    include: { user: true },
  });
  return NextResponse.json(requests);
}

export async function POST(req) {
  const data = await req.json();
  const newReq = await prisma.roleEscalation.create({ data });
  return NextResponse.json(newReq);
}

export async function PATCH(req) {
  const { id, status, reason } = await req.json();
  const updated = await prisma.roleEscalation.update({
    where: { id },
    data: { status, reason },
  });
  return NextResponse.json(updated);
}
```

---

### 4Ô∏è‚É£ Frontend (app/dashboard/admin/role-escalation/page.tsx)

```tsx
"use client";
import useSWR from "swr";
const fetcher = (url) => fetch(url).then((r) => r.json());

export default function RoleEscalation() {
  const { data, mutate } = useSWR("/api/admin/role-escalation", fetcher);

  async function handleAction(id, status) {
    await fetch("/api/admin/role-escalation", {
      method: "PATCH",
      body: JSON.stringify({ id, status }),
    });
    mutate();
  }

  return (
    <div className="p-6">
      <h1 className="text-xl font-semibold mb-4">Y√™u c·∫ßu n√¢ng quy·ªÅn</h1>
      <table className="w-full border">
        <thead><tr><th>Ng∆∞·ªùi d√πng</th><th>Quy·ªÅn y√™u c·∫ßu</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th></tr></thead>
        <tbody>
          {data?.map(r => (
            <tr key={r.id} className="border-t">
              <td>{r.user.name}</td>
              <td>{r.requestedRole}</td>
              <td>{r.status}</td>
              <td>
                <button onClick={() => handleAction(r.id, "APPROVED")} className="bg-green-600 text-white p-1 mr-2">Duy·ªát</button>
                <button onClick={() => handleAction(r.id, "REJECTED")} className="bg-red-600 text-white p-1">T·ª´ ch·ªëi</button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

---

### 5Ô∏è‚É£ UI

* S·ª≠ d·ª•ng **table** hi·ªÉn th·ªã y√™u c·∫ßu.
* C√≥ c·ªôt: H·ªç t√™n, Quy·ªÅn y√™u c·∫ßu, Tr·∫°ng th√°i, H√†nh ƒë·ªông.
* Modal chi ti·∫øt hi·ªÉn th·ªã th√¥ng tin gi·∫•y t·ªù ƒë√≠nh k√®m.

### 6Ô∏è‚É£ B·∫£o m·∫≠t & ki·ªÉm th·ª≠

* Ch·ªâ cho ph√©p `role = SYSADMIN || EIC`.
* Ki·ªÉm tra SQL injection trong tr∆∞·ªùng l√Ω do (reason).

---

## **2. Featured Articles Management (B√†i vi·∫øt n·ªïi b·∫≠t)**

### 1Ô∏è‚É£ M·ª•c ƒë√≠ch

Cho ph√©p admin ch·ªçn c√°c b√†i vi·∫øt ƒë·ªÉ hi·ªÉn th·ªã ·ªü trang ch·ªß.

---

### 2Ô∏è‚É£ Lu·ªìng d·ªØ li·ªáu

```
Admin -> GET /api/featured-articles
Admin -> POST /api/featured-articles
Admin -> DELETE /api/featured-articles/[id]
```

---

### 3Ô∏è‚É£ Backend

```ts
export async function GET() {
  const featured = await prisma.article.findMany({
    where: { featured: true },
  });
  return NextResponse.json(featured);
}

export async function POST(req) {
  const { articleId } = await req.json();
  const updated = await prisma.article.update({
    where: { id: articleId },
    data: { featured: true },
  });
  return NextResponse.json(updated);
}

export async function DELETE(req) {
  const { id } = await req.json();
  const updated = await prisma.article.update({
    where: { id },
    data: { featured: false },
  });
  return NextResponse.json(updated);
}
```

---

### 4Ô∏è‚É£ Frontend (app/dashboard/admin/featured-articles/page.tsx)

```tsx
"use client";
import useSWR from "swr";
import { useState } from "react";

export default function FeaturedArticles() {
  const { data, mutate } = useSWR("/api/featured-articles", (u) => fetch(u).then(r => r.json()));
  const [articleId, setArticleId] = useState("");

  async function handleAdd() {
    await fetch("/api/featured-articles", {
      method: "POST",
      body: JSON.stringify({ articleId }),
    });
    mutate();
  }

  async function handleRemove(id) {
    await fetch("/api/featured-articles", {
      method: "DELETE",
      body: JSON.stringify({ id }),
    });
    mutate();
  }

  return (
    <div className="p-6">
      <h2 className="text-2xl mb-4">B√†i vi·∫øt n·ªïi b·∫≠t</h2>
      <div className="mb-4">
        <input placeholder="ID b√†i vi·∫øt" onChange={(e) => setArticleId(e.target.value)} className="border p-2 mr-2"/>
        <button onClick={handleAdd} className="bg-blue-600 text-white p-2 rounded">Th√™m</button>
      </div>
      <ul>
        {data?.map(a => (
          <li key={a.id} className="flex justify-between border-b py-2">
            <span>{a.title}</span>
            <button onClick={() => handleRemove(a.id)} className="text-red-600">B·ªè n·ªïi b·∫≠t</button>
          </li>
        ))}
      </ul>
    </div>
  );
}
```

---

### 5Ô∏è‚É£ UI

* Giao di·ªán danh s√°ch b√†i n·ªïi b·∫≠t (sortable list).
* N√∫t ‚ÄúTh√™m b√†i‚Äù m·ªü modal t√¨m ki·∫øm b√†i vi·∫øt.
* Preview hi·ªÉn th·ªã gi·ªëng trang ch·ªß.

### 6Ô∏è‚É£ B·∫£o m·∫≠t

* Ch·ªâ admin/editor ƒë∆∞·ª£c ph√©p thao t√°c.
* Validate articleId h·ª£p l·ªá.

---

## **3. Deadlines Management (Qu·∫£n l√Ω h·∫°n ph·∫£n bi·ªán, bi√™n t·∫≠p)**

### 1Ô∏è‚É£ M·ª•c ƒë√≠ch

Gi√∫p bi√™n t·∫≠p vi√™n v√† ph·∫£n bi·ªán theo d√µi c√°c deadline li√™n quan t·ªõi b√†i b√°o.

---

### 2Ô∏è‚É£ Lu·ªìng d·ªØ li·ªáu

```
Editor -> POST /api/deadlines
Reviewer -> GET /api/deadlines
Editor -> PUT /api/deadlines/[id]
```

---

### 3Ô∏è‚É£ Backend

```ts
export async function GET() {
  const data = await prisma.deadline.findMany({
    include: { article: true },
  });
  return NextResponse.json(data);
}

export async function POST(req) {
  const body = await req.json();
  const deadline = await prisma.deadline.create({ data: body });
  return NextResponse.json(deadline);
}

export async function PUT(req) {
  const body = await req.json();
  const updated = await prisma.deadline.update({
    where: { id: body.id },
    data: body,
  });
  return NextResponse.json(updated);
}
```

---

### 4Ô∏è‚É£ Frontend (app/dashboard/admin/deadlines/page.tsx)

```tsx
"use client";
import useSWR from "swr";
export default function DeadlinesPage() {
  const { data, mutate } = useSWR("/api/deadlines", (u) => fetch(u).then(r => r.json()));

  return (
    <div className="p-6">
      <h1 className="text-xl font-bold mb-4">Deadline ph·∫£n bi·ªán & bi√™n t·∫≠p</h1>
      <table className="w-full border">
        <thead><tr><th>B√†i</th><th>Lo·∫°i</th><th>Ng√†y h·∫øt h·∫°n</th><th>Tr·∫°ng th√°i</th></tr></thead>
        <tbody>
          {data?.map(d => (
            <tr key={d.id} className="border-t">
              <td>{d.article?.title}</td>
              <td>{d.type}</td>
              <td>{new Date(d.dueDate).toLocaleDateString()}</td>
              <td>{d.status}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

---

### 5Ô∏è‚É£ UI

* L·ªãch d·∫°ng **Calendar View** (c√≥ th·ªÉ d√πng `react-big-calendar`).
* Cho ph√©p filter theo ‚ÄúReview‚Äù, ‚ÄúRevision‚Äù, ‚ÄúDecision‚Äù.
* Th√¥ng b√°o deadline s·∫Øp t·ªõi (<3 ng√†y).

### 6Ô∏è‚É£ B·∫£o m·∫≠t

* Ch·ªâ `EIC`, `Editor`, `Reviewer` truy c·∫≠p ƒë∆∞·ª£c.
* Validate ng√†y, kh√¥ng cho ph√©p t·∫°o deadline tr√πng b√†i.

---

üß© **K·∫øt lu·∫≠n cho giai ƒëo·∫°n 1:**
3 module n√†y khi ho√†n thi·ªán s·∫Ω gi√∫p b·∫°n ƒë·∫°t:

* ‚úÖ 100% coverage ph·∫ßn qu·∫£n tr·ªã n·ªôi b·ªô
* ‚úÖ C·∫•u tr√∫c ƒë·ªìng nh·∫•t Backend + Frontend
* ‚úÖ Chu·∫©n b·ªã d·ªØ li·ªáu th·∫≠t ƒë·ªÉ test to√†n b·ªô quy tr√¨nh ‚Äúg·ª≠i b√†i ‚Äì ph·∫£n bi·ªán ‚Äì xu·∫•t b·∫£n‚Äù