Tiáº¿p tá»¥c hoÃ n thiá»‡n chá»©c nÄƒng  theo tÆ° váº¥n vÃ  phÃ¢n tÃ­ch ká»¹ thuáº­t. ChÃº Ã½ cÃ¡c giao diá»‡n pháº£i hiá»‡n Ä‘áº¡i, Ä‘áº¹p. ÄÃ¢y lÃ  phÃ¢n tÃ­ch giai Ä‘oáº¡n 2 cá»§a tÃ´i "Tuyá»‡t vá»i ğŸ§  â€” báº¡n Ä‘ang bÆ°á»›c vÃ o **ğŸ”® Giai Ä‘oáº¡n 2: Táº§ng Dá»¯ Liá»‡u & Truy Xuáº¥t ThÃ´ng Minh**,
gá»“m 3 module trá»ng yáº¿u Ä‘á»ƒ **tra cá»©u, phÃ¢n tÃ­ch, vÃ  bÃ¡o cÃ¡o dá»¯ liá»‡u há»c thuáº­t**.

Má»¥c tiÃªu giai Ä‘oáº¡n nÃ y lÃ :

> â€œXÃ¢y dá»±ng há»‡ thá»‘ng tra cá»©u, lá»c, vÃ  xuáº¥t bÃ¡o cÃ¡o máº¡nh máº½ â€” phá»¥c vá»¥ ngÆ°á»i Ä‘á»c, nhÃ  nghiÃªn cá»©u, vÃ  quáº£n trá»‹ viÃªn táº¡p chÃ­.â€

---

# âš™ï¸ GIAI ÄOáº N 2 â€” CHI TIáº¾T Ká»¸ THUáº¬T & CODE TRIá»‚N KHAI

**(Priority 2 â€“ Tuáº§n 3â€“4)**

---

## ğŸŸ¡ Module 1: SEARCH ENGINE (PostgreSQL Full-Text Search)

### ğŸ¯ Má»¥c tiÃªu

Táº¡o há»‡ thá»‘ng tÃ¬m kiáº¿m toÃ n vÄƒn **nhanh, chÃ­nh xÃ¡c vÃ  khÃ´ng tá»‘n tÃ i nguyÃªn**, sá»­ dá»¥ng native **PostgreSQL Full-Text Search (FTS)**.

---

### ğŸ§± 1ï¸âƒ£ Thiáº¿t káº¿ CSDL (Prisma Schema)

```prisma
model Article {
  id          String   @id @default(uuid())
  title       String
  authors     String
  abstract    String?
  keywords    String?
  fullText    String?   // dÃ¹ng cho FTS
  publishedAt DateTime?
  doi         String?
  issueId     String?
  issue       Issue?    @relation(fields: [issueId], references: [id])
  status      String    @default("PUBLISHED")
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
```

---

### âš™ï¸ 2ï¸âƒ£ Cáº¥u hÃ¬nh PostgreSQL Full-Text Index

Táº¡o index (migration script hoáº·c SQL thá»§ cÃ´ng):

```sql
CREATE INDEX article_search_idx
ON "Article"
USING GIN (to_tsvector('simple', title || ' ' || coalesce(abstract, '') || ' ' || coalesce(keywords, '')));
```

---

### ğŸ§© 3ï¸âƒ£ API: `/api/search`

```ts
// app/api/search/route.ts
import { prisma } from "@/lib/prisma";
import { NextResponse } from "next/server";

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const q = searchParams.get("q") || "";

  const result = await prisma.$queryRawUnsafe(`
    SELECT id, title, authors, abstract, doi, publishedAt
    FROM "Article"
    WHERE to_tsvector('simple', title || ' ' || coalesce(abstract, '') || ' ' || coalesce(keywords, ''))
          @@ plainto_tsquery($1)
    ORDER BY publishedAt DESC
    LIMIT 50;
  `, q);

  return NextResponse.json(result);
}
```

---

### ğŸ§  4ï¸âƒ£ Giao diá»‡n tra cá»©u `/search`

```tsx
// app/search/page.tsx
"use client";
import { useState } from "react";

export default function SearchPage() {
  const [q, setQ] = useState("");
  const [results, setResults] = useState([]);

  async function handleSearch(e) {
    e.preventDefault();
    const res = await fetch(`/api/search?q=${q}`);
    setResults(await res.json());
  }

  return (
    <main className="max-w-5xl mx-auto p-6">
      <h1 className="text-2xl font-bold mb-4">ğŸ” Tra cá»©u bÃ i bÃ¡o</h1>
      <form onSubmit={handleSearch}>
        <input className="border p-2 rounded w-96" placeholder="TÃ¬m theo tiÃªu Ä‘á», tÃ¡c giáº£..." value={q} onChange={(e) => setQ(e.target.value)} />
        <button className="ml-2 bg-emerald-600 text-white px-3 py-2 rounded">TÃ¬m kiáº¿m</button>
      </form>
      <ul className="mt-6 space-y-4">
        {results.map((a) => (
          <li key={a.id} className="border-b pb-3">
            <a href={`/articles/${a.id}`} className="font-semibold text-blue-700 hover:underline">{a.title}</a>
            <p className="text-gray-600 text-sm">{a.authors}</p>
            <p className="text-gray-500 text-xs">{a.abstract?.slice(0, 120)}...</p>
          </li>
        ))}
      </ul>
    </main>
  );
}
```

---

## ğŸŸ¡ Module 2: ADVANCED FILTERING (Faceted Search)

### ğŸ¯ Má»¥c tiÃªu

Bá»• sung bá»™ lá»c thÃ´ng minh Ä‘á»ƒ **lá»c bÃ i bÃ¡o theo nhiá»u tiÃªu chÃ­**: nÄƒm, chá»§ Ä‘á», tÃ¡c giáº£, DOI, sá»‘ táº¡p chÃ­.

---

### âš™ï¸ 1ï¸âƒ£ Backend â€“ API `/api/search/filter`

```ts
// app/api/search/filter/route.ts
import { prisma } from "@/lib/prisma";
import { NextResponse } from "next/server";

export async function GET(req: Request) {
  const { searchParams } = new URL(req.url);
  const year = searchParams.get("year");
  const keyword = searchParams.get("keyword");
  const author = searchParams.get("author");

  const where: any = { status: "PUBLISHED" };
  if (year) where.publishedAt = { gte: new Date(`${year}-01-01`), lte: new Date(`${year}-12-31`) };
  if (keyword) where.keywords = { contains: keyword, mode: "insensitive" };
  if (author) where.authors = { contains: author, mode: "insensitive" };

  const articles = await prisma.article.findMany({
    where,
    select: { id: true, title: true, authors: true, doi: true, publishedAt: true },
    orderBy: { publishedAt: "desc" },
  });

  return NextResponse.json(articles);
}
```

---

### ğŸ§© 2ï¸âƒ£ Frontend â€“ Bá»™ lá»c Ä‘á»™ng

```tsx
// components/SearchFilter.tsx
"use client";
import { useState } from "react";

export default function SearchFilter({ onFilter }) {
  const [filters, setFilters] = useState({ year: "", keyword: "", author: "" });

  function handleChange(e) {
    setFilters({ ...filters, [e.target.name]: e.target.value });
  }

  async function apply() {
    const params = new URLSearchParams(filters);
    const res = await fetch(`/api/search/filter?${params}`);
    onFilter(await res.json());
  }

  return (
    <div className="p-4 bg-gray-50 rounded mb-4 flex gap-3">
      <input name="year" placeholder="NÄƒm" className="border p-2 w-24" onChange={handleChange} />
      <input name="keyword" placeholder="Tá»« khÃ³a" className="border p-2" onChange={handleChange} />
      <input name="author" placeholder="TÃ¡c giáº£" className="border p-2" onChange={handleChange} />
      <button onClick={apply} className="bg-emerald-600 text-white px-3 py-2 rounded">Lá»c</button>
    </div>
  );
}
```

---

## ğŸŸ¡ Module 3: EXPORT REPORTS (PDF / Excel)

### ğŸ¯ Má»¥c tiÃªu

Cho phÃ©p **Admin hoáº·c BiÃªn táº­p viÃªn** xuáº¥t danh sÃ¡ch bÃ i bÃ¡o Ä‘Ã£ tra cá»©u hoáº·c thá»‘ng kÃª thÃ nh **file PDF / Excel**.

---

### âš™ï¸ 1ï¸âƒ£ API xuáº¥t bÃ¡o cÃ¡o PDF

```ts
// app/api/export/pdf/route.ts
import { NextResponse } from "next/server";
import jsPDF from "jspdf";
import autoTable from "jspdf-autotable";
import { prisma } from "@/lib/prisma";

export async function GET() {
  const articles = await prisma.article.findMany({
    where: { status: "PUBLISHED" },
    select: { title: true, authors: true, doi: true, publishedAt: true },
  });

  const doc = new jsPDF();
  autoTable(doc, {
    head: [["TiÃªu Ä‘á»", "TÃ¡c giáº£", "DOI", "NÄƒm"]],
    body: articles.map(a => [a.title, a.authors, a.doi || "-", new Date(a.publishedAt).getFullYear()]),
  });

  const pdfBytes = doc.output("arraybuffer");
  return new NextResponse(Buffer.from(pdfBytes), {
    headers: { "Content-Type": "application/pdf" },
  });
}
```

---

### âš™ï¸ 2ï¸âƒ£ API xuáº¥t Excel

```ts
// app/api/export/excel/route.ts
import ExcelJS from "exceljs";
import { prisma } from "@/lib/prisma";
import { NextResponse } from "next/server";

export async function GET() {
  const workbook = new ExcelJS.Workbook();
  const sheet = workbook.addWorksheet("Articles");

  sheet.columns = [
    { header: "TiÃªu Ä‘á»", key: "title" },
    { header: "TÃ¡c giáº£", key: "authors" },
    { header: "DOI", key: "doi" },
    { header: "NÄƒm xuáº¥t báº£n", key: "year" },
  ];

  const articles = await prisma.article.findMany({
    where: { status: "PUBLISHED" },
  });

  articles.forEach(a =>
    sheet.addRow({
      title: a.title,
      authors: a.authors,
      doi: a.doi || "-",
      year: new Date(a.publishedAt).getFullYear(),
    })
  );

  const buffer = await workbook.xlsx.writeBuffer();
  return new NextResponse(Buffer.from(buffer), {
    headers: { "Content-Type": "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" },
  });
}
```

---

## ğŸ§  Tá»•ng há»£p: Lá»™ trÃ¬nh ká»¹ thuáº­t tuáº§n 3â€“4

| Tuáº§n         | Má»¥c tiÃªu               | Task                                              | CÃ´ng nghá»‡              |
| ------------ | ---------------------- | ------------------------------------------------- | ---------------------- |
| **Tuáº§n 3**   | XÃ¢y dá»±ng Search Engine | API `/api/search`, index PostgreSQL, UI `/search` | Next.js + Prisma + SQL |
| **Tuáº§n 3â€“4** | Advanced Filtering     | Bá»™ lá»c nhiá»u tiÃªu chÃ­ + UI `SearchFilter`         | Prisma Query Builder   |
| **Tuáº§n 4**   | Export Reports         | PDF + Excel xuáº¥t danh sÃ¡ch bÃ i                    | jsPDF + ExcelJS        |

---

## âš¡ Tá»‘i Æ°u & Kiá»ƒm thá»­

| Pháº§n       | Cáº§n test                    | Gá»£i Ã½                 |
| ---------- | --------------------------- | --------------------- |
| API Search | Query tá»‘c Ä‘á»™ & Ä‘á»™ chÃ­nh xÃ¡c | Jest + Benchmark      |
| FTS Index  | Hiá»‡u nÄƒng khi >10,000 bÃ i   | EXPLAIN ANALYZE       |
| PDF/Excel  | Äá»‹nh dáº¡ng báº£ng              | Kiá»ƒm tra font Unicode |
| UI Filter  | Xá»­ lÃ½ debounce input        | 300ms delay khi gÃµ    |

---

## âœ… Káº¿t quáº£ sau giai Ä‘oáº¡n 2

| ThÃ nh pháº§n                        | Káº¿t quáº£                                   |
| --------------------------------- | ----------------------------------------- |
| ğŸ” Tra cá»©u toÃ n vÄƒn               | CÃ³ thá»ƒ tÃ¬m theo tiÃªu Ä‘á», tÃ¡c giáº£, tá»« khÃ³a |
| ğŸ§© Bá»™ lá»c thÃ´ng minh              | Lá»c theo nÄƒm, chá»§ Ä‘á», DOI, tÃ¡c giáº£        |
| ğŸ“Š BÃ¡o cÃ¡o xuáº¥t PDF/Excel         | Chuáº©n Ä‘á»‹nh dáº¡ng, táº£i nhanh                |
| âš™ï¸ API tá»‘i Æ°u                     | Cache + truy váº¥n song song                |
| ğŸ“ˆ Chuáº©n bá»‹ ná»n cho Plagiarism AI | CÃ³ dá»¯ liá»‡u toÃ n vÄƒn phá»¥c vá»¥ so khá»›p       |