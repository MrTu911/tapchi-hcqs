Giáº£m kÃ­ch thÆ°á»›c banner vÃ  Footer Ä‘á»ƒ hiá»ƒn thá»‹ nhiá»u ná»™i dung hÆ¡n.  Cá»‘ Ä‘á»‹nh kÃ­ch thÆ°á»›c menu trang chá»§ lÃ  1280px. XÃ¢y dá»±ng vÃ  hoÃ n thiá»‡n phÃ¢n há»‡ chá»©c nÄƒng 3: ğŸ’» **Báº¯t Ä‘áº§u Giai Ä‘oáº¡n 3 â€“ PhÃ¢n há»‡ Quáº£n lÃ½ BÃ i bÃ¡o (Article Management System) ğŸ“„**

> Má»¥c tiÃªu: HoÃ n thiá»‡n toÃ n diá»‡n chá»©c nÄƒng quáº£n lÃ½ bÃ i bÃ¡o khoa há»c trong *Pháº§n má»m Táº¡p chÃ­ Ä‘iá»‡n tá»­ NghiÃªn cá»©u Khoa há»c Háº­u cáº§n QuÃ¢n sá»±*.
> ÄÃ¢y lÃ  phÃ¢n há»‡ trung tÃ¢m, gáº¯n vá»›i pháº£n biá»‡n, xuáº¥t báº£n, thá»‘ng kÃª, vÃ  DOI.

---

## ğŸ§© I. Tá»”NG QUAN CHá»¨C NÄ‚NG HIá»†N Táº I

| ThÃ nh pháº§n                 | Tráº¡ng thÃ¡i                            | ÄÃ¡nh giÃ¡ |
| -------------------------- | ------------------------------------- | -------- |
| CRUD bÃ i bÃ¡o               | âœ… CÃ³ `/api/articles/`                 | 9/10     |
| LiÃªn káº¿t vá»›i sá»‘ ká»³ (Issue) | âœ… CÃ³ `/api/issues/[id]/articles`      | 9/10     |
| Upload PDF                 | âœ… Hoáº¡t Ä‘á»™ng tá»‘t (`/api/files/upload`) | 9/10     |
| DOI / CrossRef             | âœ… CÃ³ tÃ­ch há»£p                         | 8/10     |
| TrÃ­ch metadata tá»« PDF      | âš ï¸ ChÆ°a cÃ³                            | 5/10     |
| Kiá»ƒm duyá»‡t trÆ°á»›c Ä‘Äƒng      | âš ï¸ ChÆ°a cÃ³                            | 6/10     |
| LÆ°u phiÃªn báº£n (Versioning) | âš ï¸ ChÆ°a cÃ³                            | 5/10     |

---

## ğŸ¯ II. Má»¤C TIÃŠU Cáº¦N HOÃ€N THIá»†N

| Háº¡ng má»¥c                        | Má»¥c tiÃªu                                     | Giáº£i phÃ¡p                              |
| ------------------------------- | -------------------------------------------- | -------------------------------------- |
| 1ï¸âƒ£ **Article Version Control** | LÆ°u nhiá»u phiÃªn báº£n chá»‰nh sá»­a cá»§a bÃ i        | Táº¡o báº£ng `ArticleVersion`              |
| 2ï¸âƒ£ **Pre-publication Review**  | Kiá»ƒm duyá»‡t ná»™i bá»™ trÆ°á»›c khi xuáº¥t báº£n         | ThÃªm field `approvalStatus`            |
| 3ï¸âƒ£ **PDF Metadata Extractor**  | TrÃ­ch tá»± Ä‘á»™ng tiÃªu Ä‘á», tÃ¡c giáº£ tá»« PDF        | DÃ¹ng `pdf-parse` hoáº·c `pdfjs-dist`     |
| 4ï¸âƒ£ **Enhanced Admin Workflow** | Bá»• sung quy trÃ¬nh kiá»ƒm duyá»‡t trong Dashboard | ThÃªm giao diá»‡n duyá»‡t bÃ i & xem lá»‹ch sá»­ |

---

## ğŸ§  III. KIáº¾N TRÃšC Há»† THá»NG BÃ€I BÃO (Sau khi hoÃ n thiá»‡n)

```
Author â†’ Submit Article â†’ Editor Review (Pre-publish)
      â†“                         â†“
ArticleVersion â†â†’ Workflow â†â†’ Issue Assignment
      â†“
CrossRef DOI â†’ Public Archive â†’ Analytics / Citation Metrics
```

---

## âš™ï¸ IV. TRIá»‚N KHAI BACKEND

### **1ï¸âƒ£ Cáº­p nháº­t Prisma Schema**

```prisma
model Article {
  id              String     @id @default(uuid())
  title           String
  abstract        String?
  pdfUrl          String?
  approvalStatus  ApprovalStatus @default(PENDING)
  versions        ArticleVersion[]
  issueId         String?
  issue           Issue? @relation(fields: [issueId], references: [id])
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model ArticleVersion {
  id         String   @id @default(uuid())
  articleId  String
  article    Article  @relation(fields: [articleId], references: [id])
  version    Int
  title      String
  pdfUrl     String
  submittedBy String
  submittedAt DateTime @default(now())
}

enum ApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}
```

---

### **2ï¸âƒ£ API â€“ Táº¡o & Quáº£n lÃ½ PhiÃªn báº£n BÃ i bÃ¡o**

ğŸ“„ `app/api/articles/[id]/versions/route.ts`

```ts
import { prisma } from "@/lib/prisma";
import { NextResponse } from "next/server";

export async function GET(req, { params }) {
  const versions = await prisma.articleVersion.findMany({
    where: { articleId: params.id },
    orderBy: { version: "desc" },
  });
  return NextResponse.json(versions);
}

export async function POST(req, { params }) {
  const { title, pdfUrl, submittedBy } = await req.json();
  const last = await prisma.articleVersion.findFirst({
    where: { articleId: params.id },
    orderBy: { version: "desc" },
  });

  const newVersion = (last?.version ?? 0) + 1;

  const version = await prisma.articleVersion.create({
    data: { articleId: params.id, version: newVersion, title, pdfUrl, submittedBy },
  });

  await prisma.article.update({
    where: { id: params.id },
    data: { title, pdfUrl },
  });

  return NextResponse.json(version);
}
```

---

### **3ï¸âƒ£ API â€“ Kiá»ƒm duyá»‡t trÆ°á»›c Ä‘Äƒng**

ğŸ“„ `app/api/articles/[id]/approve/route.ts`

```ts
import { prisma } from "@/lib/prisma";
import { requireAdmin } from "@/lib/rbac";
import { NextResponse } from "next/server";

export async function POST(req, { params }) {
  const admin = await requireAdmin(req);
  if (!admin) return NextResponse.json({ error: "KhÃ´ng cÃ³ quyá»n" }, { status: 403 });

  const { decision, reason } = await req.json();

  await prisma.article.update({
    where: { id: params.id },
    data: {
      approvalStatus: decision === "approve" ? "APPROVED" : "REJECTED",
    },
  });

  return NextResponse.json({ message: `BÃ i bÃ¡o Ä‘Ã£ ${decision === "approve" ? "Ä‘Æ°á»£c duyá»‡t" : "bá»‹ tá»« chá»‘i"}` });
}
```

---

### **4ï¸âƒ£ PDF Metadata Extractor**

ğŸ“„ `lib/pdf-metadata.ts`

```ts
import pdf from "pdf-parse";

export async function extractPdfMetadata(buffer: Buffer) {
  try {
    const data = await pdf(buffer);
    const lines = data.text.split("\n").map(l => l.trim()).filter(Boolean);

    const title = lines[0] || "KhÃ´ng rÃµ tiÃªu Ä‘á»";
    const authors = lines[1]?.includes(",") ? lines[1] : "KhÃ´ng rÃµ tÃ¡c giáº£";

    return { title, authors, textLength: data.text.length };
  } catch (e) {
    console.error("PDF extract error:", e);
    return { title: "Lá»—i trÃ­ch xuáº¥t", authors: "N/A" };
  }
}
```

Khi upload bÃ i má»›i (á»Ÿ `/api/files/upload`), tá»± Ä‘á»™ng gá»i `extractPdfMetadata()` Ä‘á»ƒ Ä‘iá»n `title` & `authors` náº¿u rá»—ng.

---

## ğŸ¨ V. FRONTEND (Dashboard + UI)

### **1ï¸âƒ£ Giao diá»‡n lá»‹ch sá»­ phiÃªn báº£n bÃ i bÃ¡o**

ğŸ“„ `app/dashboard/admin/articles/[id]/versions/page.tsx`

```tsx
"use client";
import { useEffect, useState } from "react";

export default function ArticleVersionsPage({ params }) {
  const [versions, setVersions] = useState([]);

  useEffect(() => {
    fetch(`/api/articles/${params.id}/versions`)
      .then(res => res.json())
      .then(setVersions);
  }, [params.id]);

  return (
    <div className="p-6">
      <h2 className="text-xl font-bold mb-4">Lá»‹ch sá»­ phiÃªn báº£n bÃ i bÃ¡o</h2>
      <table className="w-full border border-gray-200 text-sm">
        <thead className="bg-gray-100">
          <tr>
            <th className="p-2">PhiÃªn báº£n</th>
            <th className="p-2">TiÃªu Ä‘á»</th>
            <th className="p-2">NgÃ y ná»™p</th>
            <th className="p-2">NgÆ°á»i ná»™p</th>
            <th className="p-2">Tá»‡p PDF</th>
          </tr>
        </thead>
        <tbody>
          {versions.map(v => (
            <tr key={v.id} className="border-t">
              <td className="p-2">{v.version}</td>
              <td className="p-2">{v.title}</td>
              <td className="p-2">{new Date(v.submittedAt).toLocaleString()}</td>
              <td className="p-2">{v.submittedBy}</td>
              <td className="p-2 text-blue-500 underline">
                <a href={v.pdfUrl} target="_blank">Xem PDF</a>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
```

---

### **2ï¸âƒ£ Giao diá»‡n kiá»ƒm duyá»‡t bÃ i bÃ¡o**

ğŸ“„ `app/dashboard/admin/articles/[id]/review/page.tsx`

```tsx
"use client";
import { useState } from "react";

export default function ArticleReviewPage({ params }) {
  const [decision, setDecision] = useState("approve");
  const [reason, setReason] = useState("");

  async function handleDecision() {
    await fetch(`/api/articles/${params.id}/approve`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ decision, reason }),
    });
    alert(`ÄÃ£ ${decision === "approve" ? "duyá»‡t" : "tá»« chá»‘i"} bÃ i bÃ¡o`);
  }

  return (
    <div className="p-6">
      <h1 className="text-xl font-bold mb-4">Kiá»ƒm duyá»‡t bÃ i bÃ¡o</h1>
      <select
        className="border p-2 rounded"
        value={decision}
        onChange={e => setDecision(e.target.value)}
      >
        <option value="approve">âœ… Duyá»‡t Ä‘Äƒng</option>
        <option value="reject">âŒ Tá»« chá»‘i</option>
      </select>

      <textarea
        className="w-full border p-2 rounded mt-3"
        rows={4}
        placeholder="Ghi chÃº lÃ½ do..."
        value={reason}
        onChange={e => setReason(e.target.value)}
      />

      <button
        onClick={handleDecision}
        className="mt-4 px-4 py-2 bg-emerald-600 text-white rounded hover:bg-emerald-700"
      >
        XÃ¡c nháº­n
      </button>
    </div>
  );
}
```

---

## ğŸ“Š VI. Káº¾T QUáº¢ SAU KHI HOÃ€N THIá»†N

| Chá»©c nÄƒng             | TrÆ°á»›c | Sau                                    | Hiá»‡u quáº£            |
| --------------------- | ----- | -------------------------------------- | ------------------- |
| Quáº£n lÃ½ phiÃªn báº£n     | âŒ     | âœ… CÃ³ `ArticleVersion` & UI xem lá»‹ch sá»­ | Theo dÃµi thay Ä‘á»•i   |
| Kiá»ƒm duyá»‡t trÆ°á»›c Ä‘Äƒng | âš ï¸    | âœ… CÃ³ workflow kiá»ƒm duyá»‡t               | An toÃ n & minh báº¡ch |
| Metadata PDF          | âŒ     | âœ… Tá»± Ä‘á»™ng trÃ­ch tiÃªu Ä‘á», tÃ¡c giáº£       | Giáº£m lá»—i nháº­p tay   |
| Giao diá»‡n admin       | âš ï¸    | âœ… ThÃªm trang duyá»‡t & lá»‹ch sá»­           | NÃ¢ng UX biÃªn táº­p    |

---

## âœ… VII. Káº¾T LUáº¬N

* **Backend:**
  ÄÃ£ má»Ÿ rá»™ng há»‡ thá»‘ng thÃ nh *má»™t CMS khoa há»c hoÃ n chá»‰nh*, cÃ³ kiá»ƒm duyá»‡t, lÆ°u lá»‹ch sá»­ vÃ  Ä‘á»“ng bá»™ CrossRef.
* **Frontend:**
  Giao diá»‡n trá»±c quan, dá»… thao tÃ¡c, Ä‘áº£m báº£o quy trÃ¬nh xuáº¥t báº£n minh báº¡ch vÃ  kiá»ƒm soÃ¡t cháº¥t lÆ°á»£ng ná»™i dung.

---

ğŸ“¦ **Tá»•ng thá»ƒ phÃ¢n há»‡ 3 sau hoÃ n thiá»‡n Ä‘áº¡t:**
â­ 9.5/10 â€” chuáº©n cho triá»ƒn khai thá»±c táº¿.