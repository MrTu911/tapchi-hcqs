Bá»• sung chá»©c nÄƒng trong quáº£n lÃ½ tÃ i khoáº£n : Ráº¥t tuyá»‡t ğŸ‘ â€” bÃ¢y giá» ta Ä‘i sÃ¢u vÃ o **phÃ¢n tÃ­ch vÃ  thiáº¿t káº¿ chá»©c nÄƒng â€œÄÄƒng kÃ½ ngÆ°á»i dÃ¹ng & Duyá»‡t tÃ i khoáº£nâ€** cá»§a há»‡ thá»‘ng Táº¡p chÃ­ Ä‘iá»‡n tá»­ nghiÃªn cá»©u khoa há»c háº­u cáº§n quÃ¢n sá»±.

ÄÃ¢y lÃ  **phÃ¢n há»‡ ná»n táº£ng cho toÃ n bá»™ há»‡ thá»‘ng**, vÃ¬ nÃ³ quyáº¿t Ä‘á»‹nh *quy trÃ¬nh táº¡o, xÃ©t duyá»‡t vÃ  phÃ¢n quyá»n ngÆ°á»i dÃ¹ng (Admin / Tá»•ng biÃªn táº­p / BiÃªn táº­p viÃªn / TÃ¡c giáº£ / Pháº£n biá»‡n)*.

---

# ğŸ§© I. Má»¤C TIÃŠU CHÃNH

| Má»¥c tiÃªu                                 | Giáº£i thÃ­ch                                                                                 |
| ---------------------------------------- | ------------------------------------------------------------------------------------------ |
| ğŸ‘¤ **Quáº£n lÃ½ ngÆ°á»i dÃ¹ng táº­p trung**      | Má»—i ngÆ°á»i cÃ³ má»™t tÃ i khoáº£n duy nháº¥t, dÃ¹ng cho má»i phÃ¢n há»‡                                  |
| ğŸªª **ÄÄƒng kÃ½ tá»± nguyá»‡n (self-register)** | Cho phÃ©p ngÆ°á»i ngoÃ i Ä‘Äƒng kÃ½ tÃ i khoáº£n tÃ¡c giáº£ hoáº·c pháº£n biá»‡n                              |
| ğŸ” **Quy trÃ¬nh duyá»‡t**                   | TÃ i khoáº£n pháº£i Ä‘Æ°á»£c duyá»‡t bá»Ÿi **BiÃªn táº­p viÃªn** hoáº·c **Tá»•ng biÃªn táº­p** trÆ°á»›c khi kÃ­ch hoáº¡t |
| ğŸ” **PhÃ¢n quyá»n cháº·t cháº½ (RBAC)**        | Há»‡ thá»‘ng phÃ¢n quyá»n rÃµ: Admin / Tá»•ng biÃªn táº­p / BiÃªn táº­p viÃªn / Pháº£n biá»‡n / TÃ¡c giáº£        |
| ğŸ“œ **LÆ°u váº¿t duyá»‡t vÃ  hoáº¡t Ä‘á»™ng**        | Ghi láº¡i lá»‹ch sá»­ phÃª duyá»‡t vÃ  ngÆ°á»i thá»±c hiá»‡n                                               |
| ğŸ“§ **ThÃ´ng bÃ¡o tá»± Ä‘á»™ng**                 | Gá»­i email khi Ä‘Äƒng kÃ½ / Ä‘Æ°á»£c duyá»‡t / bá»‹ tá»« chá»‘i                                            |

---

# âš™ï¸ II. QUY TRÃŒNH ÄÄ‚NG KÃ & DUYá»†T NGÆ¯á»œI DÃ™NG

### ğŸ” **1ï¸âƒ£ NgÆ°á»i dÃ¹ng tá»± Ä‘Äƒng kÃ½**

* Äiá»n form Ä‘Äƒng kÃ½:

  * Há» tÃªn
  * Email (xÃ¡c thá»±c)
  * Máº­t kháº©u
  * Vai trÃ² mong muá»‘n (TÃ¡c giáº£, Pháº£n biá»‡n, BiÃªn táº­p viÃªn)
  * ÄÆ¡n vá»‹ / CÆ¡ quan cÃ´ng tÃ¡c
  * Sá»‘ Ä‘iá»‡n thoáº¡i
  * File minh chá»©ng (CV / tháº» cÃ´ng tÃ¡c â€“ tÃ¹y chá»n)

â†’ Há»‡ thá»‘ng táº¡o **tÃ i khoáº£n tráº¡ng thÃ¡i `PENDING`**.

---

### ğŸ” **2ï¸âƒ£ Quáº£n trá»‹ viÃªn (hoáº·c Tá»•ng biÃªn táº­p) duyá»‡t**

* Truy cáº­p trang: **/dashboard/admin/users/pending**
* Xem danh sÃ¡ch ngÆ°á»i Ä‘Äƒng kÃ½ chá» duyá»‡t
* CÃ³ thá»ƒ:

  * âœ… Duyá»‡t vÃ  cáº¥p vai trÃ² tÆ°Æ¡ng á»©ng (`role = AUTHOR | REVIEWER | EDITOR`)
  * âŒ Tá»« chá»‘i kÃ¨m lÃ½ do
  * ğŸ•“ Giá»¯ nguyÃªn á»Ÿ tráº¡ng thÃ¡i chá» xÃ¡c minh

â†’ Khi duyá»‡t, há»‡ thá»‘ng gá»­i **email thÃ´ng bÃ¡o káº¿t quáº£**.

---

### ğŸ” **3ï¸âƒ£ Sau khi duyá»‡t**

* TÃ i khoáº£n Ä‘Æ°á»£c **kÃ­ch hoáº¡t (`isActive = true`)**.
* CÃ³ thá»ƒ **Ä‘Äƒng nháº­p vÃ  truy cáº­p theo quyá»n háº¡n**.
* Há»‡ thá»‘ng ghi láº¡i log phÃª duyá»‡t:

  ```json
  {
    "approvedBy": "Editor123",
    "approvedAt": "2025-11-04T10:15:00Z"
  }
  ```

---

# ğŸ§  III. MÃ” HÃŒNH Dá»® LIá»†U (Prisma Schema)

ğŸ“„ `schema.prisma`

```prisma
model User {
  id             String   @id @default(uuid())
  fullName       String
  email          String   @unique
  passwordHash   String
  role           Role     @default(AUTHOR)
  organization   String?
  phone          String?
  cvUrl          String?
  status         String   @default("PENDING") // PENDING, APPROVED, REJECTED
  isActive       Boolean  @default(false)
  approvedBy     String?
  approvedAt     DateTime?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

enum Role {
  ADMIN
  EDITOR_IN_CHIEF
  EDITOR
  REVIEWER
  AUTHOR
}
```

---

# ğŸ§± IV. CHá»¨C NÄ‚NG CHI TIáº¾T

| Chá»©c nÄƒng                                   | MÃ´ táº£                                                | NgÆ°á»i thá»±c hiá»‡n                       |
| ------------------------------------------- | ---------------------------------------------------- | ------------------------------------- |
| **1ï¸âƒ£ ÄÄƒng kÃ½ tÃ i khoáº£n**                   | NgÆ°á»i dÃ¹ng táº¡o tÃ i khoáº£n má»›i, chá»n vai trÃ² mong muá»‘n | TÃ¡c giáº£, pháº£n biá»‡n                    |
| **2ï¸âƒ£ XÃ¡c thá»±c email**                      | Gá»­i email xÃ¡c nháº­n link kÃ­ch hoáº¡t                    | Há»‡ thá»‘ng                              |
| **3ï¸âƒ£ Quáº£n lÃ½ danh sÃ¡ch Ä‘Äƒng kÃ½ chá» duyá»‡t** | Liá»‡t kÃª tÃ i khoáº£n `status = PENDING`                 | BiÃªn táº­p viÃªn / Tá»•ng biÃªn táº­p / Admin |
| **4ï¸âƒ£ Duyá»‡t hoáº·c tá»« chá»‘i Ä‘Äƒng kÃ½**          | Cáº­p nháº­t tráº¡ng thÃ¡i `APPROVED` / `REJECTED`          | BiÃªn táº­p viÃªn hoáº·c Tá»•ng biÃªn táº­p      |
| **5ï¸âƒ£ Gá»­i thÃ´ng bÃ¡o káº¿t quáº£**               | Gá»­i email cháº¥p thuáº­n hoáº·c tá»« chá»‘i                    | Há»‡ thá»‘ng                              |
| **6ï¸âƒ£ KÃ­ch hoáº¡t tÃ i khoáº£n**                 | `isActive = true` khi Ä‘Æ°á»£c duyá»‡t                     | Há»‡ thá»‘ng                              |
| **7ï¸âƒ£ LÆ°u log phÃª duyá»‡t**                   | LÆ°u ngÆ°á»i duyá»‡t, thá»i gian                           | Há»‡ thá»‘ng                              |
| **8ï¸âƒ£ PhÃ¢n quyá»n Ä‘Äƒng nháº­p**                | Chá»‰ cho phÃ©p truy cáº­p phÃ¢n há»‡ phÃ¹ há»£p                | Middleware RBAC                       |
| **9ï¸âƒ£ Táº¡m khÃ³a / má»Ÿ khÃ³a tÃ i khoáº£n**        | Admin cÃ³ quyá»n táº¡m Ä‘Ã¬nh chá»‰ tÃ i khoáº£n                | Admin                                 |

---

# ğŸ” V. QUY Táº®C PHÃ‚N QUYá»€N SAU KHI DUYá»†T

| Vai trÃ²                | Quyá»n háº¡n                                    |
| ---------------------- | -------------------------------------------- |
| **Admin**              | ToÃ n quyá»n há»‡ thá»‘ng                          |
| **Tá»•ng biÃªn táº­p**      | Duyá»‡t tÃ i khoáº£n, gÃ¡n vai trÃ², xuáº¥t báº£n sá»‘    |
| **BiÃªn táº­p viÃªn**      | Duyá»‡t tÃ i khoáº£n (reviewer/author), duyá»‡t bÃ i |
| **Pháº£n biá»‡n**          | Truy cáº­p bÃ i Ä‘Æ°á»£c giao                       |
| **TÃ¡c giáº£**            | Gá»­i bÃ i, theo dÃµi pháº£n biá»‡n                  |
| **KhÃ¡ch (chÆ°a duyá»‡t)** | Chá»‰ xem cÃ´ng khai                            |

---

# âš™ï¸ VI. LUá»’NG NGHIá»†P Vá»¤ Tá»I Æ¯U (Workflow)

```text
[NgÆ°á»i dÃ¹ng Ä‘Äƒng kÃ½] 
      â†“
[TÃ i khoáº£n PENDING trong DB]
      â†“
[Admin/Editor kiá»ƒm duyá»‡t â†’ APPROVED / REJECTED]
      â†“
[Há»‡ thá»‘ng gá»­i email thÃ´ng bÃ¡o káº¿t quáº£]
      â†“
[TÃ i khoáº£n kÃ­ch hoáº¡t â†’ cÃ³ thá»ƒ Ä‘Äƒng nháº­p]
```

---

# ğŸ§© VII. API CHá»¨C NÄ‚NG CHÃNH

## ğŸªª ÄÄƒng kÃ½ tÃ i khoáº£n

```ts
// app/api/auth/register/route.ts
import { prisma } from "@/lib/prisma";
import bcrypt from "bcryptjs";
import { NextResponse } from "next/server";

export async function POST(req: Request) {
  const data = await req.json();
  const hash = await bcrypt.hash(data.password, 10);

  const user = await prisma.user.create({
    data: {
      fullName: data.fullName,
      email: data.email,
      passwordHash: hash,
      organization: data.organization,
      phone: data.phone,
      role: data.requestedRole || "AUTHOR",
      status: "PENDING",
    },
  });

  return NextResponse.json({ message: "ÄÄƒng kÃ½ thÃ nh cÃ´ng. Vui lÃ²ng chá» duyá»‡t." });
}
```

---

## âœ… Duyá»‡t tÃ i khoáº£n

```ts
// app/api/admin/approve-user/route.ts
import { prisma } from "@/lib/prisma";
import { NextResponse } from "next/server";

export async function POST(req: Request) {
  const { userId, status, approverId, role } = await req.json();

  const user = await prisma.user.update({
    where: { id: userId },
    data: {
      status,
      role,
      isActive: status === "APPROVED",
      approvedBy: approverId,
      approvedAt: new Date(),
    },
  });

  // (TÃ¹y chá»n) Gá»­i email thÃ´ng bÃ¡o duyá»‡t
  return NextResponse.json({ message: `TÃ i khoáº£n ${status}` });
}
```

---

# ğŸ§  VIII. Tá»I Æ¯U HIá»†U NÄ‚NG VÃ€ TRáº¢I NGHIá»†M

| Váº¥n Ä‘á»                    | Giáº£i phÃ¡p                                                         |
| ------------------------- | ----------------------------------------------------------------- |
| QuÃ¡ nhiá»u ngÆ°á»i chá» duyá»‡t | PhÃ¢n trang danh sÃ¡ch chá»                                          |
| Trá»… pháº£n há»“i khi duyá»‡t    | Sá»­ dá»¥ng `Promise.all` Ä‘á»ƒ cáº­p nháº­t nhiá»u user                      |
| UX phÃª duyá»‡t              | Hiá»ƒn thá»‹ badge tráº¡ng thÃ¡i, filter â€œPENDING / APPROVED / REJECTEDâ€ |
| An ninh email             | Token JWT 15 phÃºt cho link kÃ­ch hoáº¡t                              |
| Ghi log                   | Báº£ng `AuditLog` lÆ°u thao tÃ¡c phÃª duyá»‡t                            |

---

# ğŸ”’ IX. Báº¢O Máº¬T

âœ… Báº£o vá»‡ API Ä‘Äƒng kÃ½ & duyá»‡t:

* Hash máº­t kháº©u báº±ng bcrypt
* Cáº¥m Ä‘Äƒng kÃ½ trÃ¹ng email
* RBAC middleware kiá»ƒm tra vai trÃ² khi duyá»‡t
* Gá»­i email xÃ¡c minh Ä‘á»ƒ trÃ¡nh spam
* Giá»›i háº¡n táº§n suáº¥t Ä‘Äƒng kÃ½ (`rate limit`)

---

# ğŸ§¾ X. Lá»¢I ÃCH SAU Tá»I Æ¯U

| KhÃ­a cáº¡nh              | Hiá»‡u quáº£ Ä‘áº¡t Ä‘Æ°á»£c               |
| ---------------------- | ------------------------------- |
| ğŸ§  Quy trÃ¬nh phÃª duyá»‡t | RÃµ rÃ ng, kiá»ƒm soÃ¡t dá»… dÃ ng      |
| ğŸ”’ Báº£o máº­t             | Äáº£m báº£o an toÃ n tÃ i khoáº£n       |
| ğŸ“Š Quáº£n trá»‹            | CÃ³ lá»‹ch sá»­, phÃ¢n quyá»n chi tiáº¿t |
| ğŸš€ Tá»‘c Ä‘á»™              | ÄÄƒng kÃ½ nháº¹, duyá»‡t nhanh        |
| ğŸ’¬ Giao tiáº¿p           | Gá»­i thÃ´ng bÃ¡o email tá»± Ä‘á»™ng     |

---

âœ… **Káº¿t quáº£:**
Sau khi triá»ƒn khai Ä‘áº§y Ä‘á»§ quy trÃ¬nh nÃ y, há»‡ thá»‘ng cÃ³ thá»ƒ:

* Cho phÃ©p **Ä‘Äƒng kÃ½ má»Ÿ cho cá»™ng Ä‘á»“ng khoa há»c**,
* Duyá»‡t theo cáº¥p **BiÃªn táº­p viÃªn / Tá»•ng biÃªn táº­p**,
* Äáº£m báº£o **phÃ¢n quyá»n cháº·t cháº½ vÃ  báº£o máº­t tÃ i khoáº£n**,
* Giáº£m 70% rá»§i ro sai sÃ³t thá»§ cÃ´ng trong quáº£n lÃ½ ngÆ°á»i dÃ¹ng.